# Windows 11 を購入して最初にやっておくこと

2025-10-28 に ThinkPad を購入したので一部更新。

## ローカルアカウントでセットアップ
`ネットワークに接続しましょう` の画面で Shift+F10 を押下してコマンドプロンプトを開き、
```
oobe\BypassNRO.cmd
```
と入力する。

勝手に再起動するので再度セットアップする。

`ネットワークに接続しましょう` の画面で  
`インターネットに接続していません` > `制限された設定で続行` を選択すると、
ローカルアカウントでセットアップできる。

## Windows Update を実行して最新の状態に

## 右クリックメニューを Windows10 以前のものに
Windows+R を押下して `ファイル名を指定して実行` を開き、`regedit` と入力する。

レジストリエディタが表示されたら  
`\HKEY_CURRENT_USER\Software\Classes\CLSID` を開く。

`CLSID` の右クリックメニューから `[新規]` > `[キー]` を選択する。

新しいキーが作成されるのでこのキーの名前を

```
{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}
```

に変更する。

さらにこの `{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}` の右クリックメニューから `[新規]` > `[キー]` を選択する。

新しいキーが作成されるのでこのキーの名前を

```
InprocServer32
```

に変更する。

`InprocServer32` の中の `規定` の中身が空文字になっていることを確認後再起動する。

## 電源プラン
コントロールパネルを開き、  
`[ハードウェアとサウンド]` > `[電源オプション]` > `[プラン設定の変更]` を選択し、

* ディスプレイの電源を切る: 30
* コンピュータをスリープ状態にする: 適用しない

とする。

## OneDrive 削除
コントロールパネルを開き、  
`[プログラム]` > `[プログラムのアンインストール]` を選択し、`Microsoft OneDrive` をアンインストールする。

## 不要なプリインストールアプリも削除
スタートメニューを開き、  
`[設定]` > `[アプリ]` > `[インストールされているアプリ]` を選択する。

表示されているアプリ一覧から不要なものを全て削除する。

スタートメニューに表示されているアプリも不要なものを全て削除する。

### ThinkPad の場合
* Lenovo Now は削除
* Lenovo Smart Meeting Components は削除
* Lenovo Vantage Service は必要 (ドライバの更新用)

## タスクバーの設定
タスクバーを右クリックし、`タスクバーの設定` を選択する。

### タスクバー項目
* 検索ボックス: 非表示
* タスクビュー: 非表示
* ウィジェット: 非表示

### タスクバーの動作
* タスクバーの配置: 左揃え

## エクスプローラの設定
エクスプローラを開き、`･･･` から `オプション` を選択する。

### 全般
* エクスプローラで開く: PC
* プライバシー: 全部チェックを外す

### 表示
* `タイトルバーに完全なパスを表示する` にチェック
* `隠しファイル、隠しフォルダー、及び隠しドライブを表示する` にチェック
* `登録されている拡張子は表示しない` のチェックを **外す**

`フォルダーに適用` ボタンを押下して OK ボタンを押下して閉じる。

## 仮想マシン Platform, WSL, Hyper-V の有効化, Windows Sandbox の有効化
コントロールパネルを開き、  
`[プログラム]` > `[プログラムと機能]` > `[Windows の機能の有効化または無効化]` を選択する。


まとめてチェックいれるとエラーになることがあるので、

* `Virtual Machine Platform` にチェック

OK ボタンを押下して指示に従って再起動する。

再度 `Windows の機能の有効化または無効化` を開き、

* `Hyper-V` にチェック
* `Windows Sandbox` にチェック

OK ボタンを押下して指示に従って再起動する。

再起動後、再度 Windows Update を実施すること！

## レジストリのバックアップ
Windows+R を押下して `ファイル名を指定して実行` を開き、`regedit` と入力する。

レジストリエディタが表示されたら左ペインのツリーのルートである `コンピューター` を右クリックし、`エクスポート` を選択して保存しておく。

## 復元ポイントの作成
スタートメニューを開き、`[復元ポイントの作成]` を選択し `作成` ボタンを押下する。



## WSL, Debian の準備

### WSL のインストール
コマンドプロンプトを開き、以下のコマンドを実行する。
```
wsl --install
```
勝手に Ubuntu が入り、`Enter new UNIX username: ` と入力を求められるが Ctrl+C を押してキャンセルする。

以下のコマンドを実行してデフォルトで入ってきた Ubuntu を消し飛ばす。
```
wsl --unregister Ubuntu
```

### Debian のインストール
以下のコマンドで Debian をインストールする。
```
wsl --install -d Debian
```
デフォルトだと C ドライブに入ってしまうので、他ドライブに保存されるようにする。
```
wsl --shutdown
wsl --export Debian "D:\v\wsl\debian.tar"
wsl --unregister Debian
wsl --import debian "D:\v\wsl\debian" "D:\v\wsl\debian.tar"
```
起動すると root でログインしてしまうため、普段遣いのユーザでログインするようにする。
```
wsl -d debian -u <インストール時のユーザ名>
```

`/etc/wsl.conf` に以下の内容を追記する。
```sh
$ sudo vi /etc/wsl.conf
```
```diff
  [boot]
  systemd=true
+
+ [user]
+ default = <インストール時のユーザ名>
```

WSL  を再起動して反映されていることを確認する。
```
wsl --shutdown
wsl -d debian
```

## ブラウザ用 VM 作成
[Hyper-V を使用して比較的安全にブラウズ](/misc/hyperv-websandbox.md) を参照。
